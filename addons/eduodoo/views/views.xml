<?xml version="1.0" encoding="utf-8"?>
<odoo>
  <data>

    <!-- =========================
         CURSO
    ========================== -->
    <record id="view_eduodoo_curso_list" model="ir.ui.view">
      <field name="name">eduodoo.curso.list</field>
      <field name="model">eduodoo.curso</field>
      <field name="arch" type="xml">
        <list>
          <field name="name"/>
          <field name="level"/>
          <field name="price"/>
        </list>
      </field>
    </record>

    <record id="view_eduodoo_curso_form" model="ir.ui.view">
      <field name="name">eduodoo.curso.form</field>
      <field name="model">eduodoo.curso</field>
      <field name="arch" type="xml">
        <form string="Curso">
          <sheet>
            <group>
              <field name="name"/>
              <field name="level"/>
              <field name="price"/>
            </group>
            <group>
              <field name="description"/>
            </group>

            <notebook>
              <page string="Sesiones">
                <field name="sesion_ids">
                  <list decoration-danger="esta_llena">
                    <field name="fecha_inicio"/>
                    <field name="duracion_horas"/>
                    <field name="clase_id"/>
                    <field name="profesor_id"/>
                    <field name="asientos"/>
                    <field name="plazas_ocupadas"/>
                    <field name="porcentaje_ocupacion" widget="progressbar" options="{'max_value': 100}" sum="0" avg="1"/>
                  </list>
                </field>
              </page>
            </notebook>
          </sheet>
        </form>
      </field>
    </record>

    <record id="action_eduodoo_curso" model="ir.actions.act_window">
      <field name="name">Cursos</field>
      <field name="res_model">eduodoo.curso</field>
      <field name="view_mode">list,form</field>
    </record>


    <!-- =========================
         SESIÓN
    ========================== -->
    <record id="view_eduodoo_sesion_list" model="ir.ui.view">
      <field name="name">eduodoo.sesion.list</field>
      <field name="model">eduodoo.sesion</field>
      <field name="arch" type="xml">
        <list decoration-danger="esta_llena">
          <field name="name"/>
          <field name="curso_id"/>
          <field name="clase_id"/>
          <field name="profesor_id"/>
          <field name="asientos"/>
          <field name="plazas_ocupadas"/>
          <field name="porcentaje_ocupacion" widget="progressbar" options="{'max_value': 100}" sum="0" avg="1"/>
        </list>
      </field>
    </record>

    <record id="view_eduodoo_sesion_form" model="ir.ui.view">
      <field name="name">eduodoo.sesion.form</field>
      <field name="model">eduodoo.sesion</field>
      <field name="arch" type="xml">
        <form string="Sesión">
          <sheet>
            <div class="oe_button_box" name="button_box">
              <button name="action_view_profesor_calendar"
                      string="Calendario del Profesor"
                      type="object"
                      class="oe_stat_button"
                      icon="fa-calendar"
                      invisible="not profesor_id"/>
            </div>

            <group>
              <field name="name" readonly="1"/>
            </group>

            <group>
              <field name="curso_id"/>
              <field name="clase_id"/>
              <field name="profesor_id"/>
            </group>

            <group>
              <field name="fecha_inicio"/>
              <field name="duracion_horas"/>
              <field name="fecha_fin" readonly="1"/>
              <field name="asientos"/>
            </group>

            <group string="Ocupación">
              <field name="plazas_ocupadas" readonly="1"/>
              <field name="porcentaje_ocupacion" widget="progressbar" options="{'max_value': 100}" readonly="1" sum="0" avg="1"/>
            </group>

            <notebook>
              <page string="Matrículas">
                <field name="matricula_ids">
                  <list editable="bottom">
                    <field name="alumno_id"/>
                    <field name="fecha_matricula"/>
                    <field name="state"/>
                    <field name="estado_pago"/>
                  </list>
                </field>
              </page>

              <page string="Alumnos (vista rápida)">
                <field name="alumno_ids" widget="many2many_tags" readonly="1"/>
              </page>
            </notebook>
          </sheet>
        </form>
      </field>
    </record>

    <record id="view_eduodoo_sesion_calendar" model="ir.ui.view">
      <field name="name">eduodoo.sesion.calendar</field>
      <field name="model">eduodoo.sesion</field>
      <field name="arch" type="xml">
        <calendar string="Sesiones"
                  date_start="fecha_inicio"
                  date_stop="fecha_fin"
                  color="profesor_id">
            <field name="name"/>
            <field name="curso_id"/>
            <field name="profesor_id"/>
        </calendar>
      </field>
    </record>

    <record id="view_eduodoo_sesion_kanban" model="ir.ui.view">
      <field name="name">eduodoo.sesion.kanban</field>
      <field name="model">eduodoo.sesion</field>
      <field name="arch" type="xml">
        <kanban class="o_kanban_small_column">
          <!-- Campos que usaremos dentro de la tarjeta -->
          <field name="name"/>
          <field name="curso_id"/>
          <field name="clase_id"/>
          <field name="profesor_id"/>
          <field name="fecha_inicio"/>
          <field name="fecha_fin"/>
          <field name="porcentaje_ocupacion" sum="0" avg="1"/>
          <field name="esta_llena"/>

          <templates>
            <t t-name="kanban-box">
              <div class="oe_kanban_global_click o_kanban_record">
                <div class="o_kanban_card_header">
                  <strong>
                    <field name="name"/>
                  </strong>
                </div>

                <div class="o_kanban_card_content">
                  <div>
                    <span style="font-weight:600;">Curso:</span>
                    <field name="curso_id"/>
                  </div>

                  <div>
                    <span style="font-weight:600;">Profesor:</span>
                    <field name="profesor_id"/>
                  </div>

                  <div>
                    <span style="font-weight:600;">Grupo:</span>
                    <field name="clase_id"/>
                  </div>

                  <div style="margin-top:6px;">
                    <span style="font-weight:600;">Inicio:</span>
                    <field name="fecha_inicio"/>
                  </div>
                  <div>
                    <span style="font-weight:600;">Fin:</span>
                    <field name="fecha_fin"/>
                  </div>

                  <div style="margin-top:8px;">
                    <span style="font-weight:600;">Ocupación:</span>
                    <field name="porcentaje_ocupacion" widget="progressbar" options="{'max_value': 100}" sum="0" avg="1"/>
                  </div>

                  <t t-if="record.esta_llena.raw_value">
                    <div style="margin-top:8px;">
                      <span class="badge text-bg-danger">LLENA</span>
                    </div>
                  </t>
                </div>
              </div>
            </t>
          </templates>
        </kanban>
      </field>
    </record>


    <record id="action_eduodoo_sesion" model="ir.actions.act_window">
      <field name="name">Sesiones</field>
      <field name="res_model">eduodoo.sesion</field>
      <field name="view_mode">list,kanban,calendar,form</field>
      <field name="context">{'group_by': 'profesor_id'}</field>
    </record>


    <!-- =========================
         ALUMNO
    ========================== -->
    <record id="view_eduodoo_alumno_list" model="ir.ui.view">
      <field name="name">eduodoo.alumno.list</field>
      <field name="model">eduodoo.alumno</field>
      <field name="arch" type="xml">
        <list>
          <field name="nombre"/>
          <field name="apellidos"/>
          <field name="email"/>
        </list>
      </field>
    </record>

    <record id="view_eduodoo_alumno_form" model="ir.ui.view">
      <field name="name">eduodoo.alumno.form</field>
      <field name="model">eduodoo.alumno</field>
      <field name="arch" type="xml">
        <form string="Alumno">
          <sheet>
            <group>
              <field name="nombre"/>
              <field name="apellidos"/>
              <field name="email"/>
            </group>

            <notebook>
              <page string="Matrículas">
                <field name="matricula_ids">
                  <list editable="bottom">
                    <field name="sesion_id"/>
                    <field name="fecha_matricula"/>
                    <field name="state"/>
                    <field name="estado_pago"/>
                  </list>
                </field>
              </page>
            </notebook>
          </sheet>
        </form>
      </field>
    </record>

    <record id="action_eduodoo_alumno" model="ir.actions.act_window">
      <field name="name">Alumnos</field>
      <field name="res_model">eduodoo.alumno</field>
      <field name="view_mode">list,form</field>
    </record>


    <!-- =========================
         CLASE / GRUPO
    ========================== -->
    <record id="view_eduodoo_clase_list" model="ir.ui.view">
      <field name="name">eduodoo.clase.list</field>
      <field name="model">eduodoo.clase</field>
      <field name="arch" type="xml">
        <list>
          <field name="nombre"/>
          <field name="horario"/>
        </list>
      </field>
    </record>

    <record id="view_eduodoo_clase_form" model="ir.ui.view">
      <field name="name">eduodoo.clase.form</field>
      <field name="model">eduodoo.clase</field>
      <field name="arch" type="xml">
        <form string="Clase / Grupo">
          <sheet>
            <group>
              <field name="nombre"/>
              <field name="horario"/>
            </group>

            <group string="Sesiones">
              <field name="sesion_ids">
                <list decoration-danger="esta_llena">
                  <field name="fecha_inicio"/>
                  <field name="curso_id"/>
                  <field name="profesor_id"/>
                  <field name="asientos"/>
                  <field name="plazas_ocupadas"/>
                  <field name="porcentaje_ocupacion" widget="progressbar" options="{'max_value': 100}" sum="0" avg="1"/>
                </list>
              </field>
            </group>
          </sheet>
        </form>
      </field>
    </record>

    <record id="action_eduodoo_clase" model="ir.actions.act_window">
      <field name="name">Clases / Grupos</field>
      <field name="res_model">eduodoo.clase</field>
      <field name="view_mode">list,form</field>
    </record>


    <!-- =========================
         PROFESOR
    ========================== -->
    <record id="view_eduodoo_profesor_list" model="ir.ui.view">
      <field name="name">eduodoo.profesor.list</field>
      <field name="model">eduodoo.profesor</field>
      <field name="arch" type="xml">
        <list>
          <field name="nombre"/>
          <field name="titulacion"/>
        </list>
      </field>
    </record>

    <record id="view_eduodoo_profesor_form" model="ir.ui.view">
      <field name="name">eduodoo.profesor.form</field>
      <field name="model">eduodoo.profesor</field>
      <field name="arch" type="xml">
        <form string="Profesor">
          <sheet>
            <group>
              <field name="nombre"/>
              <field name="titulacion"/>
            </group>

            <notebook>
              <page string="Cursos">
                <field name="curso_ids" widget="many2many_tags"/>
              </page>
              <page string="Sesiones">
                <field name="sesion_ids">
                  <list>
                    <field name="fecha_inicio"/>
                    <field name="curso_id"/>
                    <field name="clase_id"/>
                    <field name="asientos"/>
                  </list>
                </field>
              </page>
            </notebook>
          </sheet>
        </form>
      </field>
    </record>

    <record id="action_eduodoo_profesor" model="ir.actions.act_window">
      <field name="name">Profesores</field>
      <field name="res_model">eduodoo.profesor</field>
      <field name="view_mode">list,form</field>
    </record>


    <!-- =========================
         FACTURA
    ========================== -->
    <record id="view_eduodoo_factura_list" model="ir.ui.view">
      <field name="name">eduodoo.factura.list</field>
      <field name="model">eduodoo.factura</field>
      <field name="arch" type="xml">
        <list>
          <field name="fecha_pago"/>
          <field name="matricula_id"/>
          <field name="alumno_id"/>
          <field name="sesion_id"/>
          <field name="cantidad"/>
          <field name="concepto"/>
        </list>
      </field>
    </record>

    <record id="view_eduodoo_factura_form" model="ir.ui.view">
      <field name="name">eduodoo.factura.form</field>
      <field name="model">eduodoo.factura</field>
      <field name="arch" type="xml">
        <form string="Factura">
          <sheet>
            <group>
              <field name="matricula_id"/>
            </group>

            <group>
              <field name="alumno_id" readonly="1"/>
              <field name="sesion_id" readonly="1"/>
            </group>

            <group>
              <field name="cantidad"/>
              <field name="fecha_pago"/>
              <field name="concepto"/>
            </group>
          </sheet>
        </form>
      </field>
    </record>

    <record id="action_eduodoo_factura" model="ir.actions.act_window">
      <field name="name">Facturas</field>
      <field name="res_model">eduodoo.factura</field>
      <field name="view_mode">list,form</field>
    </record>


    <!-- =========================
        MATRÍCULA
    ========================== -->
    <record id="view_eduodoo_matricula_list" model="ir.ui.view">
      <field name="name">eduodoo.matricula.list</field>
      <field name="model">eduodoo.matricula</field>
      <field name="arch" type="xml">
        <list>
          <field name="name"/>
          <field name="alumno_id"/>
          <field name="sesion_id"/>
          <field name="fecha_matricula"/>
          <field name="state"/>
          <field name="estado_pago"/>
        </list>
      </field>
    </record>

    <record id="view_eduodoo_matricula_form" model="ir.ui.view">
      <field name="name">eduodoo.matricula.form</field>
      <field name="model">eduodoo.matricula</field>
      <field name="arch" type="xml">
        <form string="Matrícula">

          <header>
            <button name="action_confirmar"
                    string="Confirmar"
                    type="object"
                    class="btn-primary"
                    invisible="state != 'draft'"/>

            <button name="action_marcar_pagada"
                    string="Marcar como pagada"
                    type="object"
                    class="btn-success"
                    invisible="state != 'confirmada'"/>

            <button name="action_crear_factura"
                    string="Crear / Ver factura"
                    type="object"
                    class="btn-secondary"/>
          </header>

          <sheet>

            <group>
              <field name="name" readonly="1"/>
            </group>

            <group>
              <field name="alumno_id"/>
              <field name="sesion_id"/>
            </group>

            <group>
              <field name="fecha_matricula"/>
              <field name="state" readonly="1"/>
              <field name="estado_pago"/>
            </group>

            <notebook>
              <page string="Facturas">
                <field name="factura_ids" readonly="1">
                  <list>
                    <field name="name"/>
                    <field name="fecha_pago"/>
                    <field name="cantidad"/>
                    <field name="concepto"/>
                  </list>
                </field>
              </page>
            </notebook>

          </sheet>
        </form>
      </field>
    </record>

    <record id="action_eduodoo_matricula" model="ir.actions.act_window">
      <field name="name">Matrículas</field>
      <field name="res_model">eduodoo.matricula</field>
      <field name="view_mode">list,form</field>
    </record>


    <!-- =========================
         MENÚS
    ========================== -->
    <menuitem id="menu_eduodoo_root" name="EduOdoo" sequence="10"/>

    <menuitem id="menu_eduodoo_curso" name="Cursos" parent="menu_eduodoo_root" action="action_eduodoo_curso" sequence="10"/>
    <menuitem id="menu_eduodoo_sesion" name="Sesiones" parent="menu_eduodoo_root" action="action_eduodoo_sesion" sequence="20"/>
    <menuitem id="menu_eduodoo_clase" name="Clases / Grupos" parent="menu_eduodoo_root" action="action_eduodoo_clase" sequence="30"/>
    <menuitem id="menu_eduodoo_profesor" name="Profesores" parent="menu_eduodoo_root" action="action_eduodoo_profesor" sequence="40"/>
    <menuitem id="menu_eduodoo_alumno" name="Alumnos" parent="menu_eduodoo_root" action="action_eduodoo_alumno" sequence="50"/>
    <menuitem id="menu_eduodoo_matricula" name="Matrículas" parent="menu_eduodoo_root" action="action_eduodoo_matricula" sequence="60"/>
    <menuitem id="menu_eduodoo_factura" name="Facturas" parent="menu_eduodoo_root" action="action_eduodoo_factura" sequence="70"/>

  </data>
</odoo>
